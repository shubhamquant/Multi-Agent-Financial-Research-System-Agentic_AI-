<p>Developed a four-agent AI system using Groq’s LLaMA 3.3 model and LlamaIndex-based RAG pipeline for automated financial intelligence. The system includes a Research Analyst Agent for data gathering and analysis, an Earnings Report Agent for retrieval-augmented insights, a Stock Report Generator for automated summaries, and an LLM-as-a-Judge for evaluating output reliability. Combined advanced multi-agent coordination, retrieval-augmented generation, and financial domain reasoning for robust, end-to-end research automation.</p>
<h1 id="agent-1-financial-research-analyst-agent"><strong>Agent 1: Financial Research Analyst Agent</strong></h1>
<h3 id="install-import-required-packages">Install &amp; Import Required Packages</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="op">!</span>pip install <span class="op">-</span>q groq duckduckgo<span class="op">-</span>search lxml_html_clean agno</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="op">!</span>pip install <span class="op">-</span>q newspaper4k lxml_html_clean</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="op">!</span>pip install <span class="op">-</span>q ddgs</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="co"># Imports after successful installation</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a><span class="im">from</span> textwrap <span class="im">import</span> dedent</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a><span class="im">from</span> agno.agent <span class="im">import</span> Agent</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a><span class="im">from</span> agno.models.groq <span class="im">import</span> Groq</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a><span class="im">from</span> agno.tools.duckduckgo <span class="im">import</span> DuckDuckGoTools</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a><span class="im">from</span> agno.tools.newspaper4k <span class="im">import</span> Newspaper4kTools</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a><span class="im">import</span> os</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a><span class="im">from</span> google.colab <span class="im">import</span> userdata</span></code></pre></div>
<h3 id="set-api-keys">Set API Keys</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a>os.environ[<span class="st">&#39;GROQ_API_KEY&#39;</span>] <span class="op">=</span> userdata.get(<span class="st">&#39;GROQ_API_KEY&#39;</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a>os.environ[<span class="st">&#39;PHI_API_KEY&#39;</span>] <span class="op">=</span> userdata.get(<span class="st">&#39;PHI_API_KEY&#39;</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a><span class="bu">print</span>(<span class="st">&quot;API keys have been set!&quot;</span>)</span></code></pre></div>
<pre><code>API keys have been set!</code></pre>
<h3 id="the-research-analyst-agent-with-advanced-capabilities">The Research Analyst Agent With Advanced Capabilities</h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a>research_agent <span class="op">=</span> Agent(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a>    model<span class="op">=</span>Groq(<span class="bu">id</span><span class="op">=</span><span class="st">&quot;llama-3.3-70b-versatile&quot;</span>),</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a>    tools<span class="op">=</span>[DuckDuckGoTools(), Newspaper4kTools()],</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a>    description<span class="op">=</span>dedent(<span class="st">&quot;&quot;&quot;\</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a><span class="st">        You are an elite research analyst in the financial services domain.</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a><span class="st">        Your expertise encompasses:</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true"></a><span class="st">        - Deep investigative financial research and analysis</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true"></a><span class="st">        - fact-checking and source verification</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true"></a><span class="st">        - Data-driven reporting and visualization</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true"></a><span class="st">        - Expert interview synthesis</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true"></a><span class="st">        - Trend analysis and future predictions</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true"></a><span class="st">        - Complex topic simplification</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true"></a><span class="st">        - Ethical practices</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true"></a><span class="st">        - Balanced perspective presentation</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true"></a><span class="st">        - Global context integration\</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true"></a><span class="st">    &quot;&quot;&quot;</span>),</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true"></a>    instructions<span class="op">=</span>dedent(<span class="st">&quot;&quot;&quot;\</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true"></a><span class="st">        1. Research Phase</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true"></a><span class="st">           - Search for 5 authoritative sources on the topic</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true"></a><span class="st">           - Prioritize recent publications and expert opinions</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true"></a><span class="st">           - Identify key stakeholders and perspectives</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true"></a></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true"></a><span class="st">        2. Analysis Phase</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true"></a><span class="st">           - Extract and verify critical information</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true"></a><span class="st">           - Cross-reference facts across multiple sources</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true"></a><span class="st">           - Identify emerging patterns and trends</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true"></a><span class="st">           - Evaluate conflicting viewpoints</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true"></a></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true"></a><span class="st">        3. Writing Phase</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true"></a><span class="st">           - Craft an attention-grabbing headline</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true"></a><span class="st">           - Structure content in Financial Report style</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true"></a><span class="st">           - Include relevant quotes and statistics</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true"></a><span class="st">           - Maintain objectivity and balance</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true"></a><span class="st">           - Explain complex concepts clearly</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true"></a></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true"></a><span class="st">        4. Quality Control</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true"></a><span class="st">           - Verify all facts and attributions</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true"></a><span class="st">           - Ensure narrative flow and readability</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true"></a><span class="st">           - Add context where necessary</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true"></a><span class="st">           - Include future implications</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true"></a><span class="st">    &quot;&quot;&quot;</span>),</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true"></a>    expected_output<span class="op">=</span>dedent(<span class="st">&quot;&quot;&quot;\</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true"></a><span class="st">        # {Compelling Headline}</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true"></a></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true"></a><span class="st">        ## Executive Summary</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true"></a><span class="st">        {Concise overview of key findings and significance}</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true"></a></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true"></a><span class="st">        ## Background &amp; Context</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true"></a><span class="st">        {Historical context and importance}</span></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true"></a><span class="st">        {Current landscape overview}</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true"></a></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true"></a><span class="st">        ## Key Findings</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true"></a><span class="st">        {Main discoveries and analysis}</span></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true"></a><span class="st">        {Expert insights and quotes}</span></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true"></a><span class="st">        {Statistical evidence}</span></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true"></a></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true"></a><span class="st">        ## Impact Analysis</span></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true"></a><span class="st">        {Current implications}</span></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true"></a><span class="st">        {Stakeholder perspectives}</span></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true"></a><span class="st">        {Industry/societal effects}</span></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true"></a></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true"></a><span class="st">        ## Future Outlook</span></span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true"></a><span class="st">        {Emerging trends}</span></span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true"></a><span class="st">        {Expert predictions}</span></span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true"></a><span class="st">        {Potential challenges and opportunities}</span></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true"></a></span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true"></a><span class="st">        ## Expert Insights</span></span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true"></a><span class="st">        {Notable quotes and analysis from industry leaders}</span></span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true"></a><span class="st">        {Contrasting viewpoints}</span></span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true"></a></span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true"></a><span class="st">        ## Sources &amp; Methodology</span></span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true"></a><span class="st">        {List of primary sources with key contributions}</span></span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true"></a><span class="st">        {Research methodology overview}</span></span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true"></a></span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true"></a><span class="st">        ---</span></span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true"></a><span class="st">        Research conducted by Financial Agent</span></span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true"></a><span class="st">        Credit Rating Style Report</span></span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true"></a><span class="st">        Published: </span><span class="sc">{current_date}</span></span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true"></a><span class="st">        Last Updated: </span><span class="sc">{current_time}</span><span class="st">\</span></span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true"></a><span class="st">    &quot;&quot;&quot;</span>),</span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true"></a>    markdown<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true"></a>)</span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true"></a></span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true"></a><span class="co"># User Prompt 1</span></span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true"></a>research_agent.print_response(<span class="st">&quot;Analyze the current state and future implications \</span></span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true"></a><span class="st">                              of artificial intelligence in Finance&quot;</span>, stream<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<pre><code>Output()</code></pre>
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
<h1 id="agent-2-agentic-rag-on-the-apple-earnings-report"><strong>Agent 2: Agentic RAG on the Apple Earnings Report</strong></h1>
<h3 id="install-import-required-packages-1">Install &amp; Import Required Packages</h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="op">!</span>pip install llama<span class="op">-</span>index llama<span class="op">-</span>index<span class="op">-</span>vector<span class="op">-</span>stores<span class="op">-</span>chroma llama<span class="op">-</span>index<span class="op">-</span>llms<span class="op">-</span>groq llama<span class="op">-</span>index<span class="op">-</span>embeddings<span class="op">-</span>huggingface <span class="op">-</span>q</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="im">import</span> os</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a><span class="im">import</span> time</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a><span class="im">from</span> llama_index.core <span class="im">import</span> SimpleDirectoryReader, VectorStoreIndex, SummaryIndex, Settings</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true"></a><span class="im">from</span> llama_index.core.node_parser <span class="im">import</span> SentenceSplitter</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true"></a><span class="im">from</span> llama_index.core.tools <span class="im">import</span> QueryEngineTool</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true"></a><span class="im">from</span> llama_index.core.query_engine.router_query_engine <span class="im">import</span> RouterQueryEngine</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true"></a><span class="im">from</span> llama_index.core.selectors <span class="im">import</span> LLMSingleSelector</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true"></a><span class="im">from</span> llama_index.llms.groq <span class="im">import</span> Groq</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true"></a><span class="im">from</span> llama_index.embeddings.huggingface <span class="im">import</span> HuggingFaceEmbedding</span></code></pre></div>
<h3 id="part-1-load-and-process-the-document">Part 1: Load and process the document</h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a><span class="bu">print</span>(<span class="st">&quot;Loading document...&quot;</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a>reader <span class="op">=</span> SimpleDirectoryReader(input_files<span class="op">=</span>[<span class="st">&quot;Apple Q4 2025 Earnings Call Transcript.pdf&quot;</span>])</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a>documents <span class="op">=</span> reader.load_data()</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true"></a><span class="bu">print</span>(<span class="ss">f&quot;✓ Loaded </span><span class="sc">{</span><span class="bu">len</span>(documents)<span class="sc">}</span><span class="ss"> document(s)&quot;</span>)</span></code></pre></div>
<pre><code>Loading document...
✓ Loaded 19 document(s)</code></pre>
<h3 id="split-the-document-into-chunks-of-max-1024-tokens-sentences">Split the document into chunks of max 1024 tokens (sentences)</h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a>splitter <span class="op">=</span> SentenceSplitter(chunk_size<span class="op">=</span><span class="dv">1024</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a>nodes <span class="op">=</span> splitter.get_nodes_from_documents(documents)</span></code></pre></div>
<h3 id="part-2-configure-llm-and-embedding-model">Part 2: Configure LLM and embedding model</h3>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a>Settings.llm <span class="op">=</span> Groq(model<span class="op">=</span><span class="st">&quot;llama-3.1-8b-instant&quot;</span>, timeout<span class="op">=</span><span class="dv">60</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true"></a>Settings.embed_model <span class="op">=</span> HuggingFaceEmbedding(model_name<span class="op">=</span><span class="st">&quot;BAAI/bge-small-en-v1.5&quot;</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true"></a><span class="bu">print</span>(<span class="st">&quot;✓ Models configured successfully!&quot;</span>)</span></code></pre></div>
<pre><code>/usr/local/lib/python3.12/dist-packages/huggingface_hub/utils/_auth.py:94: UserWarning: 
The secret `HF_TOKEN` does not exist in your Colab secrets.
To authenticate with the Hugging Face Hub, create a token in your settings tab (https://huggingface.co/settings/tokens), set it as secret in your Google Colab and restart your session.
You will be able to reuse this secret in all of your notebooks.
Please note that authentication is recommended but still optional to access public models or datasets.
  warnings.warn(


✓ Models configured successfully!</code></pre>
<h3 id="part-3-create-the-indexes">Part 3: Create the indexes</h3>
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a><span class="bu">print</span>(<span class="st">&quot;Creating indexes...&quot;</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true"></a>summary_index <span class="op">=</span> SummaryIndex(nodes)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true"></a>vector_index <span class="op">=</span> VectorStoreIndex(nodes)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true"></a><span class="bu">print</span>(<span class="st">&quot;✓ Indexes created successfully!&quot;</span>)</span></code></pre></div>
<pre><code>Creating indexes...
✓ Indexes created successfully!</code></pre>
<h3 id="create-query-engines-from-indexes">Create query engines from indexes</h3>
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true"></a>summary_query_engine <span class="op">=</span> summary_index.as_query_engine(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true"></a>    response_mode<span class="op">=</span><span class="st">&quot;tree_summarize&quot;</span>,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true"></a>    use_async<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true"></a>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true"></a>vector_query_engine <span class="op">=</span> vector_index.as_query_engine()</span></code></pre></div>
<h3 id="part-4-wrap-query-engines-into-tools">Part 4: Wrap query engines into tools</h3>
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true"></a>summary_tool <span class="op">=</span> QueryEngineTool.from_defaults(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true"></a>    query_engine<span class="op">=</span>summary_query_engine,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true"></a>    description<span class="op">=</span><span class="st">&quot;Useful for summarization questions about the Earnings report.&quot;</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true"></a>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true"></a>vector_tool <span class="op">=</span> QueryEngineTool.from_defaults(</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true"></a>    query_engine<span class="op">=</span>vector_query_engine,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true"></a>    description<span class="op">=</span><span class="st">&quot;Useful for finding specific facts and details from the Earnings report.&quot;</span>,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true"></a>)</span></code></pre></div>
<h3 id="part-5-create-router-query-engine">Part 5: Create router query engine</h3>
<div class="sourceCode" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true"></a>query_engine <span class="op">=</span> RouterQueryEngine(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true"></a>    selector<span class="op">=</span>LLMSingleSelector.from_defaults(),</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true"></a>    query_engine_tools<span class="op">=</span>[summary_tool, vector_tool],</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true"></a>    verbose<span class="op">=</span><span class="va">True</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true"></a>)</span></code></pre></div>
<h3 id="part-6-create-router-query-engine-to-route-between-tools">Part 6: Create router query engine to route between tools</h3>
<div class="sourceCode" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true"></a>query_engine <span class="op">=</span> RouterQueryEngine(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true"></a>    selector<span class="op">=</span>LLMSingleSelector.from_defaults(),</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true"></a>    query_engine_tools<span class="op">=</span>[summary_tool, vector_tool],</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true"></a>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true"></a><span class="bu">print</span>(<span class="st">&quot;✓ Agentic RAG system ready!&quot;</span>)</span></code></pre></div>
<pre><code>✓ Agentic RAG system ready!</code></pre>
<h3 id="part-7-define-function-to-ask-questions-with-delay-handling">Part 7: Define function to ask questions with delay handling</h3>
<div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true"></a><span class="kw">def</span> ask_question(question):</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">Question: </span><span class="sc">{</span>question<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true"></a>    <span class="bu">print</span>(<span class="st">&quot;=&quot;</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true"></a>    response <span class="op">=</span> query_engine.query(question)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true"></a>    <span class="bu">print</span>(<span class="ss">f&quot;Answer: </span><span class="sc">{</span>response<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true"></a>    <span class="cf">return</span> response</span></code></pre></div>
<h3 id="part-8-test-the-system-with-example-questions-and-delays-to-avoid-rate-limits">Part 8: Test the system with example questions and delays to avoid rate limits</h3>
<div class="sourceCode" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Testing the Agentic RAG System...&quot;</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true"></a>test_questions <span class="op">=</span> [</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true"></a>    <span class="st">&quot;What was the total revenue for the fourth quarter of fiscal 2025, and what was the year-over-year growth percentage?&quot;</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true"></a>    <span class="st">&quot;What is Apple&#39;s revenue growth forecast for the December quarter, and what is the primary reason for the expected strong performance in iPhone sales?&quot;</span>]</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true"></a><span class="cf">for</span> i, question <span class="kw">in</span> <span class="bu">enumerate</span>(test_questions):</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">Test </span><span class="sc">{i</span><span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">/</span><span class="sc">{</span><span class="bu">len</span>(test_questions)<span class="sc">}</span><span class="ss">:&quot;</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true"></a>    ask_question(question)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true"></a></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true"></a>    <span class="co"># Delay to avoid rate limits except after last question</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true"></a>    <span class="cf">if</span> i <span class="op">&lt;</span> <span class="bu">len</span>(test_questions) <span class="op">-</span> <span class="dv">1</span>:</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true"></a>        <span class="bu">print</span>(<span class="st">&quot;Waiting 5 seconds before next question...&quot;</span>)</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true"></a>        time.sleep(<span class="dv">5</span>)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true"></a></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot;=&quot;</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true"></a><span class="bu">print</span>(<span class="st">&quot;Testing completed!&quot;</span>)</span></code></pre></div>
<pre><code>Testing the Agentic RAG System...
============================================================

Test 1/2:

Question: What was the total revenue for the fourth quarter of fiscal 2025, and what was the year-over-year growth percentage?
==================================================
Answer: The total revenue for the fourth quarter of fiscal 2025 was $102.5 billion, and it represented an 8% year-over-year increase.
Waiting 5 seconds before next question...

Test 2/2:

Question: What is Apple&#39;s revenue growth forecast for the December quarter, and what is the primary reason for the expected strong performance in iPhone sales?
==================================================
Answer: Apple&#39;s revenue growth forecast for the December quarter is expected to be 10% to 12% year-over-year, which will be the company&#39;s best quarter ever. 

The primary reason for the expected strong performance in iPhone sales is the double-digit year-over-year growth, which would be the company&#39;s best iPhone quarter ever.

============================================================
Testing completed!</code></pre>
<h1 id="agent-3-stock-report-generator"><strong>Agent 3: Stock Report Generator</strong></h1>
<div class="sourceCode" id="cb24"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true"></a><span class="op">!</span>pip install yfinance <span class="op">-</span>q</span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true"></a><span class="im">import</span> os</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true"></a><span class="im">import</span> yfinance <span class="im">as</span> yf</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true"></a><span class="im">from</span> groq <span class="im">import</span> Groq</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true"></a><span class="co"># Setup Groq client</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true"></a>client <span class="op">=</span> Groq(api_key<span class="op">=</span>os.environ[<span class="st">&quot;GROQ_API_KEY&quot;</span>])</span></code></pre></div>
<h3 id="example-compare-multiple-stocks">Example: Compare multiple stocks</h3>
<div class="sourceCode" id="cb26"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">COMPARING CHIP COMPANIES&quot;</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true"></a>chip_stocks <span class="op">=</span> [<span class="st">&quot;NVDA&quot;</span>, <span class="st">&quot;AMD&quot;</span>, <span class="st">&quot;INTC&quot;</span>]</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true"></a>chip_data <span class="op">=</span> {}</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true"></a><span class="cf">for</span> ticker <span class="kw">in</span> chip_stocks:</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true"></a>    <span class="co"># Get stock data for each chip company</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true"></a>    stock <span class="op">=</span> yf.Ticker(ticker)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true"></a>    info <span class="op">=</span> stock.info</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true"></a>    current_price <span class="op">=</span> info.get(<span class="st">&quot;currentPrice&quot;</span>, <span class="st">&quot;N/A&quot;</span>)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true"></a>    pe_ratio <span class="op">=</span> info.get(<span class="st">&quot;trailingPE&quot;</span>, <span class="st">&quot;N/A&quot;</span>)</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true"></a>    market_cap <span class="op">=</span> info.get(<span class="st">&quot;marketCap&quot;</span>, <span class="st">&quot;N/A&quot;</span>)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true"></a>    week_high <span class="op">=</span> info.get(<span class="st">&quot;fiftyTwoWeekHigh&quot;</span>, <span class="st">&quot;N/A&quot;</span>)</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true"></a>    week_low <span class="op">=</span> info.get(<span class="st">&quot;fiftyTwoWeekLow&quot;</span>, <span class="st">&quot;N/A&quot;</span>)</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true"></a></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true"></a>    history_data <span class="op">=</span> stock.history(period<span class="op">=</span><span class="st">&quot;6mo&quot;</span>)</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true"></a>    avg_price <span class="op">=</span> history_data[<span class="st">&#39;Close&#39;</span>].mean()</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true"></a>    price_volatility <span class="op">=</span> history_data[<span class="st">&#39;Close&#39;</span>].std()</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true"></a></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true"></a>    news_items <span class="op">=</span> []</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true"></a>    <span class="cf">if</span> <span class="bu">hasattr</span>(stock, <span class="st">&quot;news&quot;</span>) <span class="kw">and</span> stock.news:</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true"></a>        <span class="cf">for</span> item <span class="kw">in</span> stock.news[:<span class="dv">3</span>]:</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true"></a>            title <span class="op">=</span> item.get(<span class="st">&quot;title&quot;</span>, <span class="st">&quot;No title available&quot;</span>)</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true"></a>            news_items.append(title)</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true"></a>    <span class="cf">else</span>:</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true"></a>        news_items <span class="op">=</span> [<span class="st">&quot;No recent news&quot;</span>]</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true"></a></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true"></a>    chip_data[ticker] <span class="op">=</span> {</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true"></a>        <span class="st">&quot;current_price&quot;</span>: current_price,</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true"></a>        <span class="st">&quot;pe_ratio&quot;</span>: pe_ratio,</span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true"></a>        <span class="st">&quot;market_cap&quot;</span>: market_cap,</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true"></a>        <span class="st">&quot;week_high&quot;</span>: week_high,</span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true"></a>        <span class="st">&quot;week_low&quot;</span>: week_low,</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true"></a>        <span class="st">&quot;avg_price_6mo&quot;</span>: avg_price,</span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true"></a>        <span class="st">&quot;price_volatility&quot;</span>: price_volatility,</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true"></a>        <span class="st">&quot;news&quot;</span>: news_items</span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true"></a>    }</span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true"></a>    <span class="bu">print</span>(<span class="ss">f&quot;Loaded data for </span><span class="sc">{</span>ticker<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true"></a></span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true"></a><span class="co"># Multiple stocks comparison prompt</span></span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true"></a>stock_info <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true"></a><span class="cf">for</span> ticker, stock_data <span class="kw">in</span> chip_data.items():</span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true"></a>    stock_info <span class="op">+=</span> <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true"></a><span class="ss">    </span><span class="sc">{</span>ticker<span class="sc">}</span><span class="ss">:</span></span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true"></a><span class="ss">    - Price: $</span><span class="sc">{</span>stock_data<span class="sc">.</span>get(<span class="st">&#39;current_price&#39;</span>, <span class="st">&#39;N/A&#39;</span>)<span class="sc">}</span></span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true"></a><span class="ss">    - P/E Ratio: </span><span class="sc">{</span>stock_data<span class="sc">.</span>get(<span class="st">&#39;pe_ratio&#39;</span>, <span class="st">&#39;N/A&#39;</span>)<span class="sc">}</span></span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true"></a><span class="ss">    - Market Cap: </span><span class="sc">{</span>stock_data<span class="sc">.</span>get(<span class="st">&#39;market_cap&#39;</span>, <span class="st">&#39;N/A&#39;</span>)<span class="sc">}</span></span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true"></a><span class="ss">    - Recent News: </span><span class="sc">{</span>stock_data<span class="sc">.</span>get(<span class="st">&#39;news&#39;</span>, [<span class="st">&#39;N/A&#39;</span>])[<span class="dv">0</span>]<span class="sc">}</span></span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true"></a></span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true"></a><span class="ss">    &quot;&quot;&quot;</span></span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true"></a></span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true"></a>chip_prompt <span class="op">=</span> <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true"></a><span class="ss">Compare these stocks: </span><span class="sc">{</span><span class="bu">list</span>(chip_data.keys())<span class="sc">}</span></span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true"></a></span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true"></a><span class="sc">{</span>stock_info<span class="sc">}</span></span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true"></a></span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true"></a><span class="ss">Question: Which chip company has the best growth potential?</span></span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true"></a></span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true"></a><span class="ss">Please provide a comparison with:</span></span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true"></a><span class="ss">1. Executive Summary</span></span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true"></a><span class="ss">2. Key Differences</span></span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true"></a><span class="ss">3. Recommendations</span></span>
<span id="cb26-65"><a href="#cb26-65" aria-hidden="true"></a><span class="ss">&quot;&quot;&quot;</span></span>
<span id="cb26-66"><a href="#cb26-66" aria-hidden="true"></a></span>
<span id="cb26-67"><a href="#cb26-67" aria-hidden="true"></a><span class="co"># Get AI response for chip comparison</span></span>
<span id="cb26-68"><a href="#cb26-68" aria-hidden="true"></a>chip_response <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb26-69"><a href="#cb26-69" aria-hidden="true"></a>    model<span class="op">=</span><span class="st">&quot;llama-3.3-70b-versatile&quot;</span>,</span>
<span id="cb26-70"><a href="#cb26-70" aria-hidden="true"></a>    messages<span class="op">=</span>[{<span class="st">&quot;role&quot;</span>: <span class="st">&quot;user&quot;</span>, <span class="st">&quot;content&quot;</span>: chip_prompt}],</span>
<span id="cb26-71"><a href="#cb26-71" aria-hidden="true"></a>    temperature<span class="op">=</span><span class="fl">0.3</span></span>
<span id="cb26-72"><a href="#cb26-72" aria-hidden="true"></a>)</span>
<span id="cb26-73"><a href="#cb26-73" aria-hidden="true"></a></span>
<span id="cb26-74"><a href="#cb26-74" aria-hidden="true"></a><span class="bu">print</span>(chip_response.choices[<span class="dv">0</span>].message.content)</span></code></pre></div>
<pre><code>COMPARING CHIP COMPANIES
==================================================
Loaded data for NVDA
Loaded data for AMD
Loaded data for INTC
**Executive Summary**
The comparison of chip companies NVDA, AMD, and INTC reveals distinct differences in their current market performance and valuation. While all three companies are major players in the semiconductor industry, their growth potential can be assessed by examining their price, P/E ratio, market capitalization, and recent news. Based on the provided data, we can evaluate which company has the best growth potential.

**Key Differences**
The key differences between the three companies are:

* **Price**: AMD has the highest stock price at $259.65, followed by NVDA at $206.88, and INTC at $39.5.
* **P/E Ratio**: INTC has an unusually high P/E ratio of 1316.67, indicating potentially overvalued stock. AMD&#39;s P/E ratio is 156.42, and NVDA&#39;s is 58.77.
* **Market Capitalization**: NVDA has the largest market capitalization at $5.03 trillion, followed by AMD at $421 billion, and INTC at $188 billion.
* **Recent News**: Unfortunately, no recent news titles are available for any of the companies, which could be an important factor in assessing their growth potential.

**Recommendations**
Based on the provided data, NVDA appears to have the best growth potential among the three companies. Its relatively lower P/E ratio and large market capitalization suggest a more stable and established position in the market. Additionally, NVDA&#39;s lower P/E ratio compared to AMD and INTC may indicate undervaluation, making it a more attractive investment opportunity.

However, it is essential to consider other factors such as recent news, industry trends, and financial performance before making an investment decision. The unusually high P/E ratio of INTC raises concerns about its valuation, while AMD&#39;s high P/E ratio may indicate high expectations for future growth. Ultimately, a comprehensive analysis of each company&#39;s strengths, weaknesses, and market position is necessary to determine the best investment opportunity.</code></pre>
<h3 id="agent-4-llm-as-a-judge-evaluate-rag-answers"><strong>Agent 4: LLM-as-a-Judge (Evaluate RAG Answers)</strong></h3>
<div class="sourceCode" id="cb28"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true"></a><span class="co"># ========================================</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true"></a><span class="co"># STEP 5: LLM-as-a-Judge (Evaluate RAG Answers)</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true"></a><span class="co"># ========================================</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true"></a><span class="op">!</span>pip install <span class="op">-</span>q groq</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true"></a><span class="im">from</span> groq <span class="im">import</span> Groq</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true"></a><span class="im">from</span> textwrap <span class="im">import</span> dedent</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true"></a><span class="im">import</span> json</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true"></a><span class="co"># -------------------------------------------------</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true"></a><span class="co"># 1. CONFIG – paste your Groq key</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true"></a><span class="co"># -------------------------------------------------</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true"></a>GROQ_API_KEY <span class="op">=</span> <span class="st">&quot;&quot;</span>   <span class="co"># &lt;-- your key</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true"></a></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true"></a>client <span class="op">=</span> Groq(api_key<span class="op">=</span>GROQ_API_KEY)</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true"></a></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true"></a><span class="co"># -------------------------------------------------</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true"></a><span class="co"># 2. Evaluator function (no Agent class needed)</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true"></a><span class="co"># -------------------------------------------------</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true"></a><span class="kw">def</span> llm_judge(query: <span class="bu">str</span>, answer: <span class="bu">str</span>, context: <span class="bu">str</span> <span class="op">=</span> <span class="st">&quot;&quot;</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true"></a><span class="co">    Sends query + answer + (optional) context to Groq and returns a markdown evaluation.</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true"></a>    system_prompt <span class="op">=</span> dedent(<span class="st">&quot;&quot;&quot;\</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true"></a><span class="st">    You are an impartial RAG evaluator. Rate the answer on a 1-5 scale for each criterion:</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true"></a></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true"></a><span class="st">    1. **Faithfulness** – Does the answer stay true to the context (no hallucinations)?</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true"></a><span class="st">    2. **Context Relevance** – How well does the answer use the provided context?</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true"></a><span class="st">    3. **Answer Completeness** – Does it fully address the query?</span></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true"></a><span class="st">    4. **Clarity** – Is the answer easy to read and well-structured?</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true"></a></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true"></a><span class="st">    Respond **only** in the following markdown format:</span></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true"></a></span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true"></a><span class="st">    # Evaluation</span></span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true"></a></span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true"></a><span class="st">    ## Scores</span></span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true"></a><span class="st">    - Faithfulness: X/5</span></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true"></a><span class="st">    - Context Relevance: X/5</span></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true"></a><span class="st">    - Answer Completeness: X/5</span></span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true"></a><span class="st">    - Clarity: X/5</span></span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true"></a></span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true"></a><span class="st">    ## Overall: X/20</span></span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true"></a><span class="st">    ## Suggestions: ...</span></span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true"></a><span class="st">    &quot;&quot;&quot;</span>)</span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true"></a></span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true"></a>    user_prompt <span class="op">=</span> dedent(<span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true"></a><span class="ss">    **QUERY:** </span><span class="sc">{</span>query<span class="sc">}</span></span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true"></a></span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true"></a><span class="ss">    **CONTEXT:**</span></span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true"></a><span class="ss">    </span><span class="sc">{</span>context <span class="kw">or</span> <span class="st">&quot;No context provided.&quot;</span><span class="sc">}</span></span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true"></a></span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true"></a><span class="ss">    **ANSWER:**</span></span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true"></a><span class="ss">    </span><span class="sc">{</span>answer<span class="sc">}</span></span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true"></a><span class="ss">    &quot;&quot;&quot;</span>)</span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true"></a></span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true"></a>    completion <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true"></a>        model<span class="op">=</span><span class="st">&quot;llama-3.1-8b-instant&quot;</span>,      <span class="co"># fast &amp; cheap</span></span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true"></a>        messages<span class="op">=</span>[</span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true"></a>            {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;system&quot;</span>, <span class="st">&quot;content&quot;</span>: system_prompt},</span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true"></a>            {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;user&quot;</span>,   <span class="st">&quot;content&quot;</span>: user_prompt}</span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true"></a>        ],</span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true"></a>        temperature<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true"></a>        max_tokens<span class="op">=</span><span class="dv">600</span></span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true"></a>    )</span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true"></a>    <span class="cf">return</span> completion.choices[<span class="dv">0</span>].message.content</span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true"></a></span>
<span id="cb28-67"><a href="#cb28-67" aria-hidden="true"></a><span class="co"># -------------------------------------------------</span></span>
<span id="cb28-68"><a href="#cb28-68" aria-hidden="true"></a><span class="co"># 3. Helper to run evaluation (streaming optional)</span></span>
<span id="cb28-69"><a href="#cb28-69" aria-hidden="true"></a><span class="co"># -------------------------------------------------</span></span>
<span id="cb28-70"><a href="#cb28-70" aria-hidden="true"></a><span class="kw">def</span> evaluate_rag(query: <span class="bu">str</span>, answer: <span class="bu">str</span>, context_docs: <span class="bu">list</span> <span class="op">=</span> <span class="va">None</span>):</span>
<span id="cb28-71"><a href="#cb28-71" aria-hidden="true"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb28-72"><a href="#cb28-72" aria-hidden="true"></a><span class="co">    context_docs: list of dicts with at least &#39;page_content&#39; (or just strings)</span></span>
<span id="cb28-73"><a href="#cb28-73" aria-hidden="true"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb28-74"><a href="#cb28-74" aria-hidden="true"></a>    <span class="cf">if</span> context_docs:</span>
<span id="cb28-75"><a href="#cb28-75" aria-hidden="true"></a>        context <span class="op">=</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">---</span><span class="ch">\n</span><span class="st">&quot;</span>.join(</span>
<span id="cb28-76"><a href="#cb28-76" aria-hidden="true"></a>            [doc.get(<span class="st">&quot;page_content&quot;</span>, doc)[:<span class="dv">800</span>] <span class="cf">for</span> doc <span class="kw">in</span> context_docs]</span>
<span id="cb28-77"><a href="#cb28-77" aria-hidden="true"></a>        )</span>
<span id="cb28-78"><a href="#cb28-78" aria-hidden="true"></a>    <span class="cf">else</span>:</span>
<span id="cb28-79"><a href="#cb28-79" aria-hidden="true"></a>        context <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb28-80"><a href="#cb28-80" aria-hidden="true"></a></span>
<span id="cb28-81"><a href="#cb28-81" aria-hidden="true"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb28-82"><a href="#cb28-82" aria-hidden="true"></a>    <span class="bu">print</span>(<span class="st">&quot;EVALUATING RAG OUTPUT&quot;</span>)</span>
<span id="cb28-83"><a href="#cb28-83" aria-hidden="true"></a>    <span class="bu">print</span>(<span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb28-84"><a href="#cb28-84" aria-hidden="true"></a>    <span class="bu">print</span>(<span class="ss">f&quot;QUERY: </span><span class="sc">{</span>query<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span>)</span>
<span id="cb28-85"><a href="#cb28-85" aria-hidden="true"></a>    <span class="bu">print</span>(<span class="ss">f&quot;ANSWER: </span><span class="sc">{</span>answer<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span>)</span>
<span id="cb28-86"><a href="#cb28-86" aria-hidden="true"></a>    <span class="cf">if</span> context:</span>
<span id="cb28-87"><a href="#cb28-87" aria-hidden="true"></a>        <span class="bu">print</span>(<span class="ss">f&quot;CONTEXT (first 300 chars): </span><span class="sc">{</span>context[:<span class="dv">300</span>]<span class="sc">}</span><span class="ss">…</span><span class="ch">\n</span><span class="ss">&quot;</span>)</span>
<span id="cb28-88"><a href="#cb28-88" aria-hidden="true"></a>    <span class="cf">else</span>:</span>
<span id="cb28-89"><a href="#cb28-89" aria-hidden="true"></a>        <span class="bu">print</span>(<span class="st">&quot;CONTEXT: None</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb28-90"><a href="#cb28-90" aria-hidden="true"></a></span>
<span id="cb28-91"><a href="#cb28-91" aria-hidden="true"></a>    result <span class="op">=</span> llm_judge(query, answer, context)</span>
<span id="cb28-92"><a href="#cb28-92" aria-hidden="true"></a>    <span class="bu">print</span>(result)</span>
<span id="cb28-93"><a href="#cb28-93" aria-hidden="true"></a></span>
<span id="cb28-94"><a href="#cb28-94" aria-hidden="true"></a><span class="co"># -------------------------------------------------</span></span>
<span id="cb28-95"><a href="#cb28-95" aria-hidden="true"></a><span class="co"># 4. Stock Trading Specific Example</span></span>
<span id="cb28-96"><a href="#cb28-96" aria-hidden="true"></a><span class="co"># -------------------------------------------------</span></span>
<span id="cb28-97"><a href="#cb28-97" aria-hidden="true"></a>evaluate_rag(</span>
<span id="cb28-98"><a href="#cb28-98" aria-hidden="true"></a>    query<span class="op">=</span><span class="st">&quot;Should I invest in NVIDIA based on current market conditions?&quot;</span>,</span>
<span id="cb28-99"><a href="#cb28-99" aria-hidden="true"></a>    answer<span class="op">=</span><span class="st">&quot;Based on the latest earnings report, NVIDIA shows strong growth potential with a 265% year-over-year revenue increase in Q1 2024. The company&#39;s data center segment grew by 427</span><span class="sc">% d</span><span class="st">ue to AI chip demand. However, the stock is trading near its 52-week high of $140, which presents some short-term risk. I recommend a long-term position with dollar-cost averaging.&quot;</span>,</span>
<span id="cb28-100"><a href="#cb28-100" aria-hidden="true"></a>    context_docs<span class="op">=</span>[</span>
<span id="cb28-101"><a href="#cb28-101" aria-hidden="true"></a>        {<span class="st">&quot;page_content&quot;</span>: <span class="st">&quot;NVIDIA Q1 2024 Earnings Report: Revenue reached $26 billion, up 265% year-over-year. Data center revenue was $22.6 billion, up 427</span><span class="sc">% f</span><span class="st">rom previous year. Gaming revenue was $2.6 billion. Gross margin expanded to 78.9%.&quot;</span>},</span>
<span id="cb28-102"><a href="#cb28-102" aria-hidden="true"></a>        {<span class="st">&quot;page_content&quot;</span>: <span class="st">&quot;NVIDIA stock price analysis: Current price $128.50, 52-week high $140.20, 52-week low $39.23. P/E ratio 75.2. Market cap $3.1 trillion. The stock has gained 210</span><span class="sc">% i</span><span class="st">n the past year.&quot;</span>},</span>
<span id="cb28-103"><a href="#cb28-103" aria-hidden="true"></a>        {<span class="st">&quot;page_content&quot;</span>: <span class="st">&quot;Market conditions: Fed interest rates at 5.5%, inflation at 3.2%. AI sector expected to grow at 38% CAGR through 2030. Semiconductor industry facing supply chain constraints but demand remains strong.&quot;</span>},</span>
<span id="cb28-104"><a href="#cb28-104" aria-hidden="true"></a>        {<span class="st">&quot;page_content&quot;</span>: <span class="st">&quot;Analyst ratings for NVDA: 85% Buy, 12% Hold, 3% Sell. Average price target $145.50. Morgan Stanley raised target to $160 citing continued AI dominance. Goldman Sachs maintains Buy rating with $155 target.&quot;</span>}</span>
<span id="cb28-105"><a href="#cb28-105" aria-hidden="true"></a>    ]</span>
<span id="cb28-106"><a href="#cb28-106" aria-hidden="true"></a>)</span></code></pre></div>
<pre><code>============================================================
EVALUATING RAG OUTPUT
============================================================
QUERY: Should I invest in NVIDIA based on current market conditions?

ANSWER: Based on the latest earnings report, NVIDIA shows strong growth potential with a 265% year-over-year revenue increase in Q1 2024. The company&#39;s data center segment grew by 427% due to AI chip demand. However, the stock is trading near its 52-week high of $140, which presents some short-term risk. I recommend a long-term position with dollar-cost averaging.

CONTEXT (first 300 chars): NVIDIA Q1 2024 Earnings Report: Revenue reached $26 billion, up 265% year-over-year. Data center revenue was $22.6 billion, up 427% from previous year. Gaming revenue was $2.6 billion. Gross margin expanded to 78.9%.
---
NVIDIA stock price analysis: Current price $128.50, 52-week high $140.20, 52-we…

# Evaluation

## Scores
- Faithfulness: 5/5
- Context Relevance: 5/5
- Answer Completeness: 4/5
- Clarity: 5/5

## Overall: 19/20
## Suggestions: Consider providing more information about potential risks and challenges in the short-term, such as supply chain constraints, to make the recommendation more comprehensive.</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode python"><code class="sourceCode python"></code></pre></div>
